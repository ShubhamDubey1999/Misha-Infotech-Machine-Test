<div class="container">
    <h2 class="mb-4">User Registration Form</h2>
    <div class="row">
        <div class="col-md-6">
            <form id="registrationForm" enctype="multipart/form-data">
                <div class="mb-3">
                    <label for="name" class="form-label">Name*:</label>
                    <input type="text" id="name" name="name" maxlength="25" placeholder="Enter employee name" class="form-control">
                    <div class="text-danger" id="nameError"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Gender*:</label>
                    <div>
                        <div class="form-check form-check-inline">
                            <input type="radio" name="gender" value="Male" class="form-check-input">
                            <label class="form-check-label">Male</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input type="radio" name="gender" value="Female" class="form-check-input">
                            <label class="form-check-label">Female</label>
                        </div>
                    </div>
                    <div class="text-danger" id="genderError"></div>
                </div>

                <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth*:</label>
                    <input type="date" id="dob" name="dob" class="form-control">
                    <div class="text-danger" id="dobError"></div>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">Email Address:</label>
                    <input type="email" id="email" name="email" placeholder="Enter email" class="form-control">
                    <div class="text-danger" id="emailError"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Contact No.*:</label>
                    <div class="d-flex gap-2">
                        <input type="text" id="mobile" name="mobile" placeholder="Mobile" class="form-control">
                        <input type="text" id="phone" name="phone" placeholder="Phone" class="form-control">
                    </div>
                    <div class="text-danger" id="contactError"></div>
                </div>

                <div class="mb-3">
                    <label for="state" class="form-label">State*:</label>
                    <select id="state" name="StateId" class="form-select" onchange="populateCity()">
                        <option value="">- Select State -</option>
                    </select>
                    <div class="text-danger" id="stateError"></div>
                </div>

                <div class="mb-3">
                    <label for="city" class="form-label">City:</label>
                    <select id="city" name="CityId" class="form-select">
                        <option value="">- Select City -</option>
                    </select>
                    <div class="text-danger" id="cityError"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Hobbies:</label>
                    <div class="form-check form-check-inline">
                        <input type="checkbox" name="hobbies" value="Chess" class="form-check-input">
                        <label class="form-check-label">Chess</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="checkbox" name="hobbies" value="Cricket" class="form-check-input">
                        <label class="form-check-label">Cricket</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="checkbox" name="hobbies" value="Football" class="form-check-input">
                        <label class="form-check-label">Football</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="checkbox" name="hobbies" value="Hockey" class="form-check-input">
                        <label class="form-check-label">Hockey</label>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="photo" class="form-label">Photo:</label>
                    <input type="file" id="photo" name="photo" accept=".jpg,.jpeg,.png" class="form-control">
                    <div class="text-danger" id="photoError"></div>
                </div>

                <div class="mb-3 form-check">
                    <input type="checkbox" id="terms" name="terms" class="form-check-input">
                    <label for="terms" class="form-check-label">I agree Terms and Conditions</label>
                    <div class="text-danger" id="termsError"></div>
                </div>

                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
        <div class="col-md-6">
        </div>
    </div>
</div>

<script>
    $(document).ready(() => {

        function GetStates() {
            $.ajax({
                url: "GetStates",
                type: "GET",
                success: (resp) => {
                    $("#state").empty();
                    var row = `<option value="">- Select State -</option>`;
                    resp.forEach(state => {
                        row += `<option value="${state.stateId}">${state.name}</option>`;
					});
                    $("#state").append(row);
                },
                error: (err) => {
                    console.error("Error fetching states:", err);
                }
            });
        }

        GetStates();

    });

    function populateCity() {
        $.ajax({
            url: "GetCities?stateId=" + $("#state").val(),
            type: "get",
            async: true,
            success: (resp) => {
                $("#city").empty();
                var row = `<option value="">- Select City -</option>`;
                resp.forEach(state => {
                    row += `<option value="${state.cityId}">${state.name}</option>`;
                });
                $("#city").append(row);
            }
        });
    }

    document.getElementById("registrationForm").addEventListener("submit", function (e) {
        e.preventDefault();

        let valid = true;
        document.querySelectorAll(".text-danger").forEach(el => el.textContent = "");

        const name = document.getElementById("name").value.trim();
        if (name === "") { document.getElementById("nameError").textContent = "Name is required"; valid = false; }

        const gender = document.querySelector('input[name="gender"]:checked');
        if (!gender) { document.getElementById("genderError").textContent = "Select gender"; valid = false; }

        const dob = document.getElementById("dob").value;
        if (!dob) { document.getElementById("dobError").textContent = "DOB required"; valid = false; }

        const mobile = document.getElementById("mobile").value.trim();
        const phone = document.getElementById("phone").value.trim();
        if (mobile === "" && phone === "") { document.getElementById("contactError").textContent = "Either Mobile or Phone is required"; valid = false; }

        const state = document.getElementById("state").value;
        if (state === "") { document.getElementById("stateError").textContent = "Select valid state"; valid = false; }

        const photo = document.getElementById("photo").value;
        if (photo && !(/\.(jpg|jpeg|png)$/i).test(photo)) { document.getElementById("photoError").textContent = "Photo must be jpg or png"; valid = false; }

        const terms = document.getElementById("terms").checked;
        if (!terms) { document.getElementById("termsError").textContent = "You must agree to terms"; valid = false; }

        if (!valid) return;

        var formData = new FormData(this);
        var selectedHobbies = [];
        $('input[name="hobbies"]:checked').each(function () {
            selectedHobbies.push($(this).val());
        });
        formData.append("Hobbies", selectedHobbies.join(','))

        $.ajax({
            url: '/User/CreateUser',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                window.location.href = '/User/Index';
            },
            error: function (xhr) {
                if (xhr.status === 400) {
                    var errors = xhr.responseJSON;
                    $.each(errors, function (key, value) {
                        $('#' + key + 'Error').text(value);
                    });
                } else {
                    alert('Something went wrong!');
                }
            }
        });
    });

</script>